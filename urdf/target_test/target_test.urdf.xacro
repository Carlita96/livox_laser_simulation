<?xml version="1.0"?>
<robot name="sensors_gazebo" xmlns:xacro="http://www.ros.org/wiki/xacro">
    <!-- Create base -->
    <link name="base_footprint" />
    <joint name="footprint" type="fixed" >
        <parent link="base_footprint" />
        <child link="base_link" />
        <origin xyz="0 0 0.05" rpy="0 0 0" />
    </joint>
    
    <link name="base_link" >
        <visual>
        <geometry>
        <box size="5.0 5.0 0.1" />
        </geometry>
        </visual>
        <collision>
        <geometry>
        <box size="5.0 5.0 0.1" />
        </geometry>
        </collision>
        <inertial>
        <origin xyz="0 0 0"/>
        <mass value="10"/>
        <inertia ixx="3.0" ixy="0.0" ixz="0.0"
        iyy="3.0" iyz="0.0" 
        izz="3.0" />
        </inertial>
    </link>

    <!-- Link Properties -->
    <xacro:property name="config_gazebo_file" value="$(find livox_laser_simulation)/config/target_test_config.yaml" />
    <xacro:property name="config_gazebo" value="${load_yaml(config_gazebo_file)}" />

    <!-- Read ground truth -->
    <xacro:property name="ground_truth" value="${config_gazebo['ground_truth']}" />

    <!-- Lidar 1 Pose from Base Link -->
    <xacro:property name="pose_lidar_1_from_base_link" value="${ground_truth['pose_lidar_1_from_base_link']}" />
    <xacro:property name="lidar_1_position" value="${pose_lidar_1_from_base_link['x_pos']} 
                    ${pose_lidar_1_from_base_link['y_pos']} ${pose_lidar_1_from_base_link['z_pos']}" />
    <xacro:property name="lidar_1_orientation" value="${pose_lidar_1_from_base_link['roll']}   
                    ${pose_lidar_1_from_base_link['pitch']} ${pose_lidar_1_from_base_link['yaw']}" />

    <!-- LiDAR 2 Pose from LiDAR 1 -->
    <xacro:property name="pose_lidar_2_from_lidar_1" value="${ground_truth['pose_lidar_2_from_lidar_1']}" />
    <xacro:property name="lidar_2_position" value="${pose_lidar_2_from_lidar_1['x_pos']} 
                    ${pose_lidar_2_from_lidar_1['y_pos']} ${pose_lidar_2_from_lidar_1['z_pos']}" />
    <xacro:property name="lidar_2_orientation" value="${pose_lidar_2_from_lidar_1['roll']}   
                    ${pose_lidar_2_from_lidar_1['pitch']} ${pose_lidar_2_from_lidar_1['yaw']}" />
    
    <!-- Sensors -->  
    <xacro:include filename="$(find livox_laser_simulation)/urdf/livox_mid70.xacro" />
      
    <xacro:Livox_Mid70 name="lidar_1" parent="base_link" topic="${ground_truth['topic_lidar_1']}">
        <origin xyz="${lidar_1_position}" rpy="${lidar_1_orientation}" />
    </xacro:Livox_Mid70>

    <xacro:Livox_Mid70 name="lidar_2" parent="lidar_1" topic="${ground_truth['topic_lidar_2']}">
        <origin xyz="${lidar_2_position}" rpy="${lidar_2_orientation}" />
    </xacro:Livox_Mid70>
</robot>